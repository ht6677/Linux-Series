# 条件执行

# 命令连接

如果使用逻辑 AND（&&）运算符成功执行 command1，请运行 command2：

```sh
command1 && command2
```

例如，如果存在 wget 命令则执行 echo 命令：

```sh
$ type -a wget >/dev/null && echo "wget command found. Download the Linux kernel ..."
```

类似地，仅当 foo 命令使用逻辑 OR 运算符返回非零退出状态时，才执行 bar 命令：

```sh
$ foo || bar
```

因此，我们可以结合 bash 退出命令和退出代码来构建快速逻辑，如下所示：

```sh
$ my_command && echo "Done" || echo "Failed"
$ /usr/bin/rsnapshot daily && echo "Backup successful" || echo "Backup failed. Alerting OPS team..."
$ mkdir /opt/kernel && cd $_ && echo "Directory created and you are in $PWD"
```

我们还可以将某些命令合并编组：

```sh
[ -f /path/to/file ] && { echo "File found. Starting ...";
                          /path/to/command2;
                          /path/to/command3 arg1 arg2;
                        }

## another example ##
[[ "$value" != "Yes" ]] && {
                              _errs=("${_errs[@]}" "<p>The I/O thread for reading the master's binary log not found ($v: $value)</p>");
                              _is_error_found="true";
                             }
```

我们可以参考如下相对完整的示例：

```sh
BAK=/data2
TAPE=/dev/st0
echo "Trying to backup ${BAK} directory to tape device ${TAPE} .."

# See if $BAK directory exists or not, else die
# Set unsuccessful shell script termination with exit status # 1
[ ! -d $BAK ] && { echo "Source backup directory $BAK not found."; exit 1; }

# See if $TAPE device exists or not, else die
# Set unsuccessful shell script termination with exit status # 2
[ ! -b $TAPE ] && { echo "Backup tape drive $TAPE not found or configured."; exit 2; }

# Okay back it up
tar cvf $TAPE $BAK 2> /tmp/error.log

if [ $? -ne 0 ]
then
   # die with unsuccessful shell script termination exit status # 3
   echo "An error occurred while making a tape backup, see /tmp/error.log file".
   exit 3
fi

# Terminate our shell script with success message i.e. backup done!
exit 0

chmod +x datatapebackup.sh
./datatapebackup.sh
echo $?
```

成功或异常终止时，我们所有的 shell 命令都将返回退出代码。我们可以在 shell 脚本中使用 exit 命令提供退出代码。我们还学习了如何利用退出状态的功能在 Shell 脚本或命令行中构建逻辑。

# 链接

- https://www.vegardstikbakke.com/how-do-pipes-work-sigpipe/
